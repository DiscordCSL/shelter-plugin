(()=>{var d=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var R=(e,n)=>{for(var t in n)d(e,t,{get:n[t],enumerable:!0})},S=(e,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let l of b(n))!L.call(e,l)&&l!==t&&d(e,l,{get:()=>n[l],enumerable:!(s=p(n,l))||s.enumerable});return e};var C=e=>S(d({},"__esModule",{value:!0}),e);var x={};R(x,{onLoad:()=>M,onUnload:()=>Y});var{plugin:{store:o},flux:{dispatcher:i,stores:{ChannelStore:m,SelectedChannelStore:D,MessageStore:I}}}=shelter,{getChannel:w}=m,{getChannelId:c}=D,{getMessages:T}=I,A=()=>w(c()),u=new Set,r=-1,a=c(),E,y=Symbol("quickreply_deletePendingReply_int");function k(){if(!o.scroll)return;let e=document.querySelector('[data-list-id="chat-messages"]');Array.from(e.children).find(t=>t.firstChild?.className?.includes("replying-"))?.scrollIntoView({behavior:o.scrollSmooth?"smooth":void 0,block:"center"})}function G(e,n,t,s){typeof s>"u"&&(s=e.guild_id!==null),i.dispatch({type:"CREATE_PENDING_REPLY",channel:e,message:n,shouldMention:t&&!o.noPing,showMentionToggle:s}),setTimeout(k,100)}function f(e){i.dispatch({type:"DELETE_PENDING_REPLY",channelId:c(),...e})}function g(e){a!==e.channelId&&(a=e.channelId,r=-1)}function N(e){E=e.message.id}function _(e){E=void 0,e[y]||(r=-1)}async function P(e){if(!e.ctrlKey&&!e.metaKey||e.key!=="ArrowUp"&&e.key!=="ArrowDown")return;let n=(await T(c())).toArray().reverse(),t=n.findIndex(s=>s.id===E)||0;if(e.key==="ArrowUp"?r=t+1:e.key==="ArrowDown"&&(r=t-1),r>n.length&&(r=n.length),r<0)return f();f({[y]:!0}),G(A(),n[r],!u.has(c()))}function h({channelId:e,shouldMention:n}){n?u.delete(e):u.add(e)}function M(){o.scroll===void 0&&(o.scroll=!0),o.scrollSmooth===void 0&&(o.scrollSmooth=!0),o.noPing===void 0&&(o.noPing=!1),i.subscribe("CHANNEL_SELECT",g),i.subscribe("CREATE_PENDING_REPLY",N),i.subscribe("DELETE_PENDING_REPLY",_),i.subscribe("SET_PENDING_REPLY_SHOULD_MENTION",h),window.addEventListener("keydown",P)}function Y(){i.unsubscribe("CHANNEL_SELECT",g),i.unsubscribe("CREATE_PENDING_REPLY",N),i.unsubscribe("DELETE_PENDING_REPLY",_),i.unsubscribe("SET_PENDING_REPLY_SHOULD_MENTION",h),window.removeEventListener("keydown",P)}return C(x);})();
